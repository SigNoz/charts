suite: Missing required values handling
tests:
  - it: should generate password if missing when create is true
    set:
      clickhouseOperator:
        secret:
          create: true
          name: my-ch-creds
          username: testuser
          password: ""
    template: templates/clickhouse-operator/secret.yaml
    asserts:
      - isKind:
          of: Secret
      - equal:
          path: stringData.username
          value: testuser
      - exists:
          path: stringData.password
      - matchRegex:
          path: stringData.password
          pattern: "^[A-Za-z0-9]{24}$"
  - it: should error if username is missing when create is true
    set:
      clickhouseOperator:
        secret:
          create: true
          name: my-ch-creds
          username: ""
          password: testpass
    template: templates/clickhouse-operator/secret.yaml
    asserts:
      - failedTemplate:
          errorMessage: ".Values.clickhouseOperator.secret.username is required when secret.create is true"
